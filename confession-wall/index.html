<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Confession Wall</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #222; color: #fff; text-align: center; padding: 20px; }
        h1 { color: #f4d03f; text-transform: uppercase; letter-spacing: 5px; }
        
        .container { max-width: 600px; margin: auto; }
        
        /* INPUT AREA */
        textarea { width: 100%; height: 80px; padding: 10px; border-radius: 5px; border: none; font-family: inherit; margin-bottom: 10px; }
        button { width: 100%; padding: 15px; background: #e74c3c; color: white; border: none; font-size: 1.2rem; cursor: pointer; font-weight: bold; }
        button:hover { background: #c0392b; }

        /* WALL AREA */
        #wall { margin-top: 30px; text-align: left; }
        .note { background: #333; padding: 15px; margin-bottom: 15px; border-left: 5px solid #f4d03f; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .timestamp { font-size: 0.8rem; color: #888; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ¤« Confession Wall</h1>
        <p>Anonymous. Permanent. Cloud-Based.</p>
        
        <textarea id="msgInput" placeholder="Write your secret here..."></textarea>
        <button onclick="postConfession()">POST TO WALL</button>

        <div id="wall">
            </div>
    </div>

    <script>
        // Use localhost for now (we will change this when we deploy)
        const API_URL = "/api/confessions";

        // 1. LOAD MESSAGES ON START
        async function loadMessages() {
            const res = await fetch(API_URL);
            const data = await res.json();
            
            const wall = document.getElementById('wall');
           // Inside loadMessages()...
wall.innerHTML = data.map(msg => `
    <div class="note">
        <div style="display:flex; justify-content:space-between;">
            <span>"${msg.text}"</span>
            <button onclick="deleteConfession('${msg._id}')" style="background:none; color:red; border:none; width:auto; padding:0; cursor:pointer;">âœ–</button>
        </div>
        <span class="timestamp">${new Date(msg.date).toLocaleString()}</span>
    </div>
`).join('');
        }

        // 2. POST MESSAGE
        async function postConfession() {
            const input = document.getElementById('msgInput');
            const text = input.value;
            
            if(!text) return alert("Write something!");

            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });

            input.value = ''; // Clear box
            loadMessages(); // Reload wall
        }
async function deleteConfession(id) {
    // Optional: Ask for confirmation so users don't delete by accident
    if(!confirm("Delete this secret?")) return;

    // Send the DELETE command to the server
    await fetch(`${API_URL}/${id}`, {
        method: 'DELETE'
    });

    loadMessages(); // Refresh the wall
}
        // Run on load
        loadMessages();
    </script>
</body>
</html> 